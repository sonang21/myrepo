/* *************************************************************************
 * NAME : dbo.UDP_NURIBOT_UPDATE_TEMP
 * TYPE : PROCEDURE (SQL_STORED_PROCEDURE)
 * TIME : Create: 2015-09-15 17:47:25.237
 *        Modify: 2015-09-17 15:56:07.58
 *        Backup: 20180521_1737
 ************************************************************************* */



CREATE PROCEDURE [dbo].[UDP_NURIBOT_UPDATE_TEMP]

@strVcode char(4),
@strDutyCode char(2)

AS
BEGIN
	SET NOCOUNT ON
	--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

	DECLARE @U TABLE
	(
		IDX INT IDENTITY(1,1) PRIMARY KEY,
		PLMODELNO INT,
		PLVCODE INT,
		PLGOODSNM NVARCHAR(200),
		PLCATEGORY VARCHAR(8),
		PLPRICE MONEY,
		PLURL VARCHAR(500),
		PLNOTE NVARCHAR(200),
		PLSRVFLAG CHAR(1), 
		PLSTATUS CHAR(1),
		PLSOLDOUTFLAG TINYINT, 
		PLSOLDOUTDATE SMALLDATETIME,
		PLRIGHTNLEFT CHAR(1),
		PLNO BIGINT,
		PLIMGURL VARCHAR(250),
		PLCOUPON TINYINT, 
		PLAIRCONFEETYPE CHAR(1),
		PLACCOUNT_YN CHAR(1),
		PLIMGURLFLAG CHAR(1),
		PLINSTANCE_PRICE MONEY,
		PLGOODSFACTORY NVARCHAR(50),
		PLGOODSCODE VARCHAR(50),
		PLDELIVERYINFO NVARCHAR(100),
		PLCASHBACK INT,
		PLSUBSIDE TINYINT, 
		PLFREEINTEREST NVARCHAR(50), 
		PLAGREE_MONTH TINYINT, 
		PLHOMEFLAG CHAR(1),
		PLPRICE_CARD MONEY,
		OPTIONFLAG2 CHAR(1), 
		CATALOGFLAG CHAR(1),
		PLDELIVERY_LEV VARCHAR(100), 
		PLSET_YN CHAR(1), 
		PLSTORE_FLAG CHAR(1), 
		PLCA_CODE_DEPT VARCHAR(12),
		PLDUTYCODE VARCHAR(2)
	)


	INSERT INTO @U(PLMODELNO, 
					PLVCODE, 
					PLGOODSNM, 
					PLCATEGORY, 
					PLPRICE, 
					PLURL, 
					PLNOTE, 
					PLSRVFLAG, 
					PLSTATUS, 
					PLSOLDOUTFLAG, 
					PLSOLDOUTDATE, 
					PLRIGHTNLEFT, 
					PLNO, 
					PLIMGURL, 
					PLCOUPON, 
					PLAIRCONFEETYPE, 
					PLACCOUNT_YN, 
					PLIMGURLFLAG, 
					PLINSTANCE_PRICE, 
					PLGOODSFACTORY,
					PLGOODSCODE, 
					PLDELIVERYINFO, 
					PLCASHBACK, 
					PLSUBSIDE, 
					PLFREEINTEREST, 
					PLAGREE_MONTH, 
					PLHOMEFLAG, 
					PLPRICE_CARD, 
					OPTIONFLAG2, 
					CATALOGFLAG, 
					PLDELIVERY_LEV, 
					PLSET_YN, 
					PLSTORE_FLAG, 
					PLCA_CODE_DEPT, 
					PLDUTYCODE)
	SELECT TOP 2000 PL_MODELNO, 
					PL_VCODE, 
					PL_GOODSNM, 
					PL_CATEGORY, 
					PL_PRICE, 
					PL_URL, 
					PL_NOTE, 
					PL_SRVFLAG, 
					PL_STATUS, 
					PL_SOLDOUTFLAG, 
					PL_SOLDOUTDATE, 
					PL_RIGHTNLEFT, 
					PL_NO, 
					PL_IMGURL,	
					PL_COUPON, 
					PL_AIRCONFEETYPE,
					PL_ACCOUNT_YN, 
					PL_IMGURLFLAG, 
					PL_INSTANCE_PRICE, 
					PL_GOODSFACTORY,
					PL_GOODSCODE, 
					PL_DELIVERYINFO, 
					PL_CASHBACK,	
					PL_SUBSIDE, 
					PL_FREEINTEREST, 
					PL_AGREE_MONTH, 
					PL_HOMEFLAG, 
					PL_PRICE_CARD, 
					OPTION_FLAG2, 
					CATALOG_FLAG, 
					PL_DELIVERY_LEV, 
					PL_SET_YN, 
					PL_STORE_FLAG, 
					PL_CA_CODE_DEPT, 
					@strDutyCode 
	FROM PRICELIST WITH (READUNCOMMITTED) 
	WHERE PL_VCODE = @strVcode AND PL_STATUS = '0' AND PL_MODELNO < 1 AND PL_DUTYCODE = @strDutyCode % 10 AND PL_NO % 80 = @strDutyCode
		
	
	INSERT OPENQUERY (ORADB, 'SELECT MODELNO, 
									SHOP_CODE, 
									GOODSNM, 
									CA_CODE, 
									PRICE, 
									URL, 
									NOTE, 
									SRVFLAG, 
									STATUS, 
									SOLDFLAG, 
									SOLDDATE, 
									RIGHTNLEFT, 
									PL_NO, 
									IMGURL, 
									COUPON, 
									AIRCONFEETYPE, 
									ACCOUNT_YN, 
									IMGURLFLAG, 
									INSTANCE_PRICE, 
									GOODSFACTORY, 
									GOODSCODE, 
									DELIVERYINFO, 
									CASHBACK, 
									SUBSIDE, 
									FREEINTEREST, 
									AGREE_MONTH, 
									HOMEFLAG, 
									PRICE_CARD, 
									OPTION_FLAG2, 
									CATALOG_FLAG, 
									DELIVERY_LEV, 
									SET_YN, 
									STORE_FLAG, 
									CA_CODE_DEPT, 
									DUTYCODE 
								FROM TBL_PRICELIST_TEMP')
	SELECT PLMODELNO, 
			PLVCODE, 
			PLGOODSNM, 
			PLCATEGORY, 
			PLPRICE, 
			PLURL, 
			PLNOTE, 
			PLSRVFLAG, 
			PLSTATUS, 
			PLSOLDOUTFLAG, 
			PLSOLDOUTDATE, 
			PLRIGHTNLEFT, 
			PLNO, 
			PLIMGURL, 
			PLCOUPON, 
			PLAIRCONFEETYPE, 
			PLACCOUNT_YN, 
			PLIMGURLFLAG, 
			PLINSTANCE_PRICE, 
			PLGOODSFACTORY,
			PLGOODSCODE, 
			PLDELIVERYINFO, 
			PLCASHBACK, 
			PLSUBSIDE, 
			PLFREEINTEREST, 
			PLAGREE_MONTH, 
			PLHOMEFLAG, 
			PLPRICE_CARD, 
			OPTIONFLAG2, 
			CATALOGFLAG, 
			PLDELIVERY_LEV, 
			PLSET_YN, 
			PLSTORE_FLAG, 
			PLCA_CODE_DEPT, 
			PLDUTYCODE
	FROM @U
			 

	--UPDATE PRICELIST SET PL_STATUS = '0' WHERE PL_NO IN (SELECT PLNO FROM @U)

END































































































































