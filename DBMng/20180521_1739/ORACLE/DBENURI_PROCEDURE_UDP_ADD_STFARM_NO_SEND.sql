/* *************************************************************************
 * NAME : DBENURI.UDP_ADD_STFARM_NO_SEND
 * TYPE : PROCEDURE
 * TIME : Create: 2018-03-28 18:50:00
 *        Modify: 2018-03-28 18:50:02
 *        Backup: 20180521_1739
 ************************************************************************* */


  CREATE OR REPLACE PROCEDURE "DBENURI"."UDP_ADD_STFARM_NO_SEND" AS 
BEGIN
INSERT INTO TBL_STFARM_NO_SEND (
SELECT SRR_STFARM_NO,SYSDATE FROM ( 
SELECT SRR_STFARM_NO,SRR_ID,SRR_STFARM_ID,SRR_FLAG,SHOP_CODE,SERVICE,decode(service,0,2,1,4,2,3,1) OD FROM TBL_SHOP_REQUESTREG
LEFT JOIN TBL_SHOPLIST ON  TBL_SHOP_REQUESTREG.SRR_ID = TBL_SHOPLIST.ID 
WHERE SRR_STFARM_NO IS NOT NULL 
AND SRR_STFARM_NO NOT IN (SELECT SRR_STFARM_NO FROM TBL_STFARM_NO_SEND )
AND ((SRR_STFARM_NO NOT IN (500022962,500012193,500062249,500072015,500002165,500029082,500000912) AND decode(service,0,2,1,4,2,3,1) = 1 ) 
OR (SRR_STFARM_NO NOT IN (500031053, 500042038) AND decode(service,0,2,1,4,2,3,1) = 4 ))
) WHERE od = 4 );
COMMIT;
END UDP_ADD_STFARM_NO_SEND;